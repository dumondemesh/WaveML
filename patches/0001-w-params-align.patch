From 72164b493d98d6b178554a333baa92e2b3d9c3c2 Mon Sep 17 00:00:00 2001
From: Dumonde <dumonde.mesh@gmail.com>
Date: Thu, 16 Oct 2025 16:20:02 +0300
Subject: [PATCH] feat+perf: W params (n_fft/hop), rustfft backend, Align op,
 acceptance updated

---
 .DS_Store                                 | Bin 8196 -> 8196 bytes
 .github/ISSUE_TEMPLATE/bug_report.md      |  17 +++++++++++++++++
 .github/ISSUE_TEMPLATE/feature_request.md |  14 ++++++++++++++
 .github/PULL_REQUEST_TEMPLATE.md          |  12 ++++++++++++
 README.md                                 |  11 +++++++++++
 docs/adr/0001-choice-of-stack.md          |  11 +++++++++++
 docs/context_capsule.md                   |  18 ++++++++++++++++++
 make_waveml_zip.zsh                       |   1 +
 patches/0001-w-params.patch               |  11 +++++++++++
 9 files changed, 95 insertions(+)
 create mode 100644 .github/ISSUE_TEMPLATE/bug_report.md
 create mode 100644 .github/ISSUE_TEMPLATE/feature_request.md
 create mode 100644 .github/PULL_REQUEST_TEMPLATE.md
 create mode 100644 docs/adr/0001-choice-of-stack.md
 create mode 100644 docs/context_capsule.md
 create mode 100644 patches/0001-w-params.patch

diff --git a/.DS_Store b/.DS_Store
index 5fe3a32e2478ee5fabb28b801f4b102bc4a37403..9d193919fe91583d4fea4fa501b38147fd434f84 100644
GIT binary patch
delta 46
zcmZp1XmQw(D<Hzkki<~Rkjaq4kdjiIoRgHFpToF0OQ4;3Vu}1_b)E;zo7pA)vI77}
C@eZs2

delta 109
zcmZp1XmQw(D=>M70N>_G0%gqMatz@Ni40{7sSLghJ`C{;Mhpf(Y|5a^U<hP^NHd_Q
z0fRA+ZNOj-B#js>8T1&c7%~|OJah7slXCKt7#J7?fY_0NfsyY&7;N?s*~1M01|S)o

diff --git a/.github/ISSUE_TEMPLATE/bug_report.md b/.github/ISSUE_TEMPLATE/bug_report.md
new file mode 100644
index 0000000..f8f3017
--- /dev/null
+++ b/.github/ISSUE_TEMPLATE/bug_report.md
@@ -0,0 +1,17 @@
+---
+name: Bug report
+about: Проблема/регресс
+---
+
+**Что случилось**
+Кратко.
+
+**Как воспроизвести**
+Команды/входные файлы.
+
+**Ожидаемое**
+...
+
+**Артефакты**
+- фрагмент из `build/acceptance/index.md`
+- соответствующие `.wfr.json`
diff --git a/.github/ISSUE_TEMPLATE/feature_request.md b/.github/ISSUE_TEMPLATE/feature_request.md
new file mode 100644
index 0000000..4d9080d
--- /dev/null
+++ b/.github/ISSUE_TEMPLATE/feature_request.md
@@ -0,0 +1,14 @@
+---
+name: Feature request
+about: Улучшим WaveML
+---
+
+**Задача**
+...
+
+**DoR/DoD**
+- DoR: критерии начала
+- DoD: тесты/отчёты/перф/док-апдейт
+
+**Acceptances**
+Новые/изменённые кейсы в `acceptance/tests.yaml`.
diff --git a/.github/PULL_REQUEST_TEMPLATE.md b/.github/PULL_REQUEST_TEMPLATE.md
new file mode 100644
index 0000000..50d5487
--- /dev/null
+++ b/.github/PULL_REQUEST_TEMPLATE.md
@@ -0,0 +1,12 @@
+## Что сделано
+- [ ] Код/фичи
+- [ ] Тесты (`acceptance/tests.yaml` обновлён)
+- [ ] Отчёты (`build/reports/*.wfr.json` приложены)
+
+## Чек-лист
+- [ ] Линтеры проходят (R7/R8, clippy -D warnings)
+- [ ] Acceptance: PASS/FAIL как ожидается
+- [ ] ADR/CHANGELOG обновлены при необходимости
+
+## Скрин/артефакты
+- Вставьте выдержку из `build/acceptance/index.md`
diff --git a/README.md b/README.md
index 33fbb8c..744e422 100644
--- a/README.md
+++ b/README.md
@@ -1 +1,12 @@
 [![WaveML Acceptance](https://github.com/dumondemesh/WaveML/actions/workflows/acceptance.yml/badge.svg)](https://github.com/dumondemesh/WaveML/actions/workflows/acceptance.yml)
+# WaveML (proto)
+
+WaveML — минимальный стек для декларативного аудио-ML графа: компилятор (WML→IR),
+линтеры (R7/R8), рантайм (W/T/D), отчёты `.wfr`, acceptance-раннер.
+
+## Быстрый старт
+```bash
+cargo build
+cargo run -p wavectl -- compile examples/hello_down.wml -o build/hello_down.wmlb.json --strict
+cargo run -p wavectl -- run build/hello_down.wmlb.json --in examples/dummy.wfm.json --out build/out.wfm.json
+cargo run -p wavectl -- acceptance --plan acceptance/tests.yaml --outdir build/acceptance --strict
diff --git a/docs/adr/0001-choice-of-stack.md b/docs/adr/0001-choice-of-stack.md
new file mode 100644
index 0000000..8be5448
--- /dev/null
+++ b/docs/adr/0001-choice-of-stack.md
@@ -0,0 +1,11 @@
+# ADR-0001: Стек и форматы (Rust/ABI/WaveForm)
+## Context
+Нужны строгие линтеры и быстрый рантайм → язык Rust; формат IR — JSON (wmlb); сигнал — WaveForm (JSON).
+
+## Decision
+- Язык: Rust (crates: waveforge, wavelint, waverunner, wavereport, wavectl)
+- Форматы: WML (текст), IR (wmlb.json), отчёты (.wfr.json)
+- Базовые операторы: W/T/D; линтеры R7/R8 обязательны
+
+## Consequences
+- Простая интеграция в CI; контроль через acceptance; переносимость
diff --git a/docs/context_capsule.md b/docs/context_capsule.md
new file mode 100644
index 0000000..3a86a54
--- /dev/null
+++ b/docs/context_capsule.md
@@ -0,0 +1,18 @@
+# WaveML — context capsule (Freeze v1.0)
+Repo: https://github.com/dumondemesh/WaveML • Branch: master • Commit: 8bb508f
+Baseline: Freeze v1.0 • ABI: 1.0
+
+## Focus
+- Параметры W (n_fft/hop) + отчёт/тесты
+- Ускорение STFT/iSTFT через FFT
+- Align/C/A операторы и тесты
+
+## Status
+- Done: D(λ,aa), WT roundtrip, R7/R8, acceptance зелёный
+- Risks: производительность FFT, семантика компоновки W→D→T, Unicode-ключи
+- Next: параметризация W, rustfft, Align
+
+## Artifacts
+- build/acceptance/index.md
+- build/reports/*.wfr.json
+- examples/*.wml, acceptance/*.wml
\ No newline at end of file
diff --git a/make_waveml_zip.zsh b/make_waveml_zip.zsh
index 4048035..ec54bdf 100755
--- a/make_waveml_zip.zsh
+++ b/make_waveml_zip.zsh
@@ -9,6 +9,7 @@ INCLUDE=(
   "crates"
   "examples"
   "acceptance"
+  "docs"
   ".github"
   "Cargo.toml"
   "rust-toolchain.toml"
diff --git a/patches/0001-w-params.patch b/patches/0001-w-params.patch
new file mode 100644
index 0000000..a14a888
--- /dev/null
+++ b/patches/0001-w-params.patch
@@ -0,0 +1,11 @@
+@@ "node": { "op": "W", ...
+-   "params": { "bank": "hann-default" }
++   "params": {
++     "bank": "hann-default",
++     "n_fft": { "type": "integer", "minimum": 16, "default": 1024 },
++     "hop":   { "type": "integer", "minimum": 1,  "default": 256 },
++     "window":{ "type": "string",  "enum": ["hann","hamming","blackman"], "default": "hann" },
++     "center":{ "type": "boolean", "default": true },
++     "pad_mode": { "type": "string", "enum": ["reflect"], "default": "reflect" }
++   }
+
-- 
2.50.1 (Apple Git-155)

